"use strict";var se=Object.create;var w=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,ie=Object.prototype.hasOwnProperty;var ue=(a,e)=>{for(var r in e)w(a,r,{get:e[r],enumerable:!0})},W=(a,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of oe(e))!ie.call(a,s)&&s!==r&&w(a,s,{get:()=>e[s],enumerable:!(t=ne(e,s))||t.enumerable});return a};var _=(a,e,r)=>(r=a!=null?se(ae(a)):{},W(e||!a||!a.__esModule?w(r,"default",{value:a,enumerable:!0}):r,a)),ce=a=>W(w({},"__esModule",{value:!0}),a);var be={};ue(be,{ClusterBasePath:()=>T,List:()=>J,ManagementBasePath:()=>F,ProjectBasePath:()=>B,VClusterBasePath:()=>H,client:()=>te,getApiHost:()=>D,getProjectNamespace:()=>ve});module.exports=ce(be);var m=_(require("js-cookie"));var $="virtualcluster.loft.sh",Q="v1";var h="cluster.loft.sh",R="v1";var j="v1";var z="apiextensions.k8s.io",X="v1";var Y={ManagementV1ProjectMembers:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"members",namespaced:!1,kind:"ProjectMembers"},ManagementV1VirtualClusterInstance:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"",namespaced:!0,kind:"VirtualClusterInstance"},ManagementV1VirtualClusterInstanceLog:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"log",namespaced:!0,kind:"VirtualClusterInstanceLog"},ManagementV1UserAccessKeys:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"accesskeys",namespaced:!1,kind:"UserAccessKeys"},ManagementV1License:{group:"management.loft.sh",version:"v1",resource:"licenses",subResource:"",namespaced:!1,kind:"License"},ManagementV1LicenseRequest:{group:"management.loft.sh",version:"v1",resource:"licenses",subResource:"request",namespaced:!1,kind:"LicenseRequest"},ManagementV1ProjectImportSpace:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"importspace",namespaced:!1,kind:"ProjectImportSpace"},ManagementV1TaskLog:{group:"management.loft.sh",version:"v1",resource:"tasks",subResource:"log",namespaced:!1,kind:"TaskLog"},ManagementV1Task:{group:"management.loft.sh",version:"v1",resource:"tasks",subResource:"",namespaced:!1,kind:"Task"},ManagementV1ResetAccessKey:{group:"management.loft.sh",version:"v1",resource:"resetaccesskeys",subResource:"",namespaced:!1,kind:"ResetAccessKey"},ManagementV1DirectClusterEndpointToken:{group:"management.loft.sh",version:"v1",resource:"directclusterendpointtokens",subResource:"",namespaced:!1,kind:"DirectClusterEndpointToken"},ManagementV1ProjectMigrateSpaceInstance:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"migratespaceinstance",namespaced:!1,kind:"ProjectMigrateSpaceInstance"},ManagementV1SpaceInstance:{group:"management.loft.sh",version:"v1",resource:"spaceinstances",subResource:"",namespaced:!0,kind:"SpaceInstance"},ManagementV1ProjectChartInfo:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"chartinfo",namespaced:!1,kind:"ProjectChartInfo"},ManagementV1IngressAuthToken:{group:"management.loft.sh",version:"v1",resource:"ingressauthtokens",subResource:"",namespaced:!1,kind:"IngressAuthToken"},ManagementV1Cluster:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"",namespaced:!1,kind:"Cluster"},ManagementV1ClusterReset:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"reset",namespaced:!1,kind:"ClusterReset"},ManagementV1Project:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"",namespaced:!1,kind:"Project"},ManagementV1PolicyViolation:{group:"management.loft.sh",version:"v1",resource:"policyviolations",subResource:"",namespaced:!1,kind:"PolicyViolation"},ManagementV1ClusterMembers:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"members",namespaced:!1,kind:"ClusterMembers"},ManagementV1Event:{group:"management.loft.sh",version:"v1",resource:"events",subResource:"",namespaced:!1,kind:"Event"},ManagementV1ClusterAccess:{group:"management.loft.sh",version:"v1",resource:"clusteraccesses",subResource:"",namespaced:!1,kind:"ClusterAccess"},ManagementV1Config:{group:"management.loft.sh",version:"v1",resource:"configs",subResource:"",namespaced:!1,kind:"Config"},ManagementV1ClusterRoleTemplate:{group:"management.loft.sh",version:"v1",resource:"clusterroletemplates",subResource:"",namespaced:!1,kind:"ClusterRoleTemplate"},ManagementV1TeamClusters:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"clusters",namespaced:!1,kind:"TeamClusters"},ManagementV1UserClusters:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"clusters",namespaced:!1,kind:"UserClusters"},ManagementV1SpaceConstraint:{group:"management.loft.sh",version:"v1",resource:"spaceconstraints",subResource:"",namespaced:!1,kind:"SpaceConstraint"},ManagementV1SpaceTemplate:{group:"management.loft.sh",version:"v1",resource:"spacetemplates",subResource:"",namespaced:!1,kind:"SpaceTemplate"},ManagementV1VirtualClusterInstanceKubeConfig:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"kubeconfig",namespaced:!0,kind:"VirtualClusterInstanceKubeConfig"},ManagementV1Team:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"",namespaced:!1,kind:"Team"},ManagementV1OwnedAccessKey:{group:"management.loft.sh",version:"v1",resource:"ownedaccesskeys",subResource:"",namespaced:!1,kind:"OwnedAccessKey"},ManagementV1Feature:{group:"management.loft.sh",version:"v1",resource:"features",subResource:"",namespaced:!1,kind:"Feature"},ManagementV1ProjectCharts:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"charts",namespaced:!1,kind:"ProjectCharts"},ManagementV1ProjectSecret:{group:"management.loft.sh",version:"v1",resource:"projectsecrets",subResource:"",namespaced:!0,kind:"ProjectSecret"},ManagementV1SharedSecret:{group:"management.loft.sh",version:"v1",resource:"sharedsecrets",subResource:"",namespaced:!0,kind:"SharedSecret"},ManagementV1ClusterCharts:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"charts",namespaced:!1,kind:"ClusterCharts"},ManagementV1TeamAccessKeys:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"accesskeys",namespaced:!1,kind:"TeamAccessKeys"},ManagementV1ProjectTemplates:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"templates",namespaced:!1,kind:"ProjectTemplates"},ManagementV1ProjectMigrateVirtualClusterInstance:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"migratevirtualclusterinstance",namespaced:!1,kind:"ProjectMigrateVirtualClusterInstance"},ManagementV1User:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"",namespaced:!1,kind:"User"},ManagementV1SubjectAccessReview:{group:"management.loft.sh",version:"v1",resource:"subjectaccessreviews",subResource:"",namespaced:!1,kind:"SubjectAccessReview"},ManagementV1Kiosk:{group:"management.loft.sh",version:"v1",resource:"kiosk",subResource:"",namespaced:!1,kind:"Kiosk"},ManagementV1LoftUpgrade:{group:"management.loft.sh",version:"v1",resource:"loftupgrades",subResource:"",namespaced:!1,kind:"LoftUpgrade"},ManagementV1ProjectImportVirtualCluster:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"importvirtualcluster",namespaced:!1,kind:"ProjectImportVirtualCluster"},ManagementV1UserProfile:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"profile",namespaced:!1,kind:"UserProfile"},ManagementV1App:{group:"management.loft.sh",version:"v1",resource:"apps",subResource:"",namespaced:!1,kind:"App"},ManagementV1Announcement:{group:"management.loft.sh",version:"v1",resource:"announcements",subResource:"",namespaced:!1,kind:"Announcement"},ManagementV1ClusterVirtualClusterDefaults:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"virtualclusterdefaults",namespaced:!1,kind:"ClusterVirtualClusterDefaults"},ManagementV1SelfSubjectAccessReview:{group:"management.loft.sh",version:"v1",resource:"selfsubjectaccessreviews",subResource:"",namespaced:!1,kind:"SelfSubjectAccessReview"},ManagementV1AgentAuditEvent:{group:"management.loft.sh",version:"v1",resource:"agentauditevents",subResource:"",namespaced:!1,kind:"AgentAuditEvent"},ManagementV1Self:{group:"management.loft.sh",version:"v1",resource:"selves",subResource:"",namespaced:!1,kind:"Self"},ManagementV1ProjectClusters:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"clusters",namespaced:!1,kind:"ProjectClusters"},ManagementV1LicenseToken:{group:"management.loft.sh",version:"v1",resource:"licensetokens",subResource:"",namespaced:!1,kind:"LicenseToken"},ManagementV1ClusterMemberAccess:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"memberaccess",namespaced:!1,kind:"ClusterMemberAccess"},ManagementV1ClusterConnect:{group:"management.loft.sh",version:"v1",resource:"clusterconnect",subResource:"",namespaced:!1,kind:"ClusterConnect"},ManagementV1VirtualClusterTemplate:{group:"management.loft.sh",version:"v1",resource:"virtualclustertemplates",subResource:"",namespaced:!1,kind:"VirtualClusterTemplate"},ManagementV1ClusterDomain:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"domain",namespaced:!1,kind:"ClusterDomain"}};var l={...Y,ClusterV1SleepModeConfig:{group:h,version:R,resource:"sleepmodeconfigs",kind:"SleepModeConfig",namespaced:!0},ClusterV1Space:{group:h,version:R,resource:"spaces",kind:"Space"},ClusterV1ClusterQuota:{group:h,version:R,resource:"clusterquotas",kind:"ClusterQuota"},ClusterV1HelmRelease:{group:h,version:R,resource:"helmreleases",kind:"HelmRelease",namespaced:!0},ClusterV1VirtualCluster:{group:h,version:R,resource:"virtualclusters",kind:"VirtualCluster",namespaced:!0},ClusterV1LocalClusterAccess:{group:h,version:R,resource:"localclusteraccesses",kind:"LocalClusterAccess"},ClusterV1ChartInfo:{group:h,version:R,resource:"chartinfos",kind:"ChartInfo"},VirtualclusterV1HelmRelease:{group:$,version:Q,resource:"helmreleases",kind:"HelmRelease",namespaced:!0},CustomResourceDefinition:{group:z,version:X,resource:"customresourcedefinitions",kind:"CustomResourceDefinition"},PolicyV1beta1JsPolicy:{group:"policy.jspolicy.com",version:"v1beta1",resource:"jspolicies",kind:"JsPolicy"},PolicyV1beta1JsPolicyViolations:{group:"policy.jspolicy.com",version:"v1beta1",resource:"jspolicyviolations",kind:"JsPolicyViolations"},StorageV1VirtualCluster:{group:"storage.loft.sh",version:j,resource:"virtualclusters",kind:"VirtualCluster",namespaced:!0},StorageV1ClusterQuota:{group:"storage.loft.sh",version:j,resource:"clusterquotas",kind:"ClusterQuota"},StorageV1LocalUser:{group:"storage.loft.sh",version:j,resource:"localusers",kind:"LocalUser"},NetworkingV1beta1Ingress:{group:"networking.k8s.io",version:"v1beta1",resource:"ingresses",kind:"Ingress",namespaced:!0},NetworkingV1Ingress:{group:"networking.k8s.io",version:"v1",resource:"ingresses",kind:"Ingress",namespaced:!0},V1StatefulSet:{group:"apps",version:"v1",resource:"statefulsets",kind:"StatefulSet",namespaced:!0},V1Deployment:{group:"apps",version:"v1",resource:"deployments",kind:"Deployment",namespaced:!0},V1Event:{group:"",version:"v1",resource:"events",kind:"Event",namespaced:!0},V1Pod:{group:"",version:"v1",resource:"pods",kind:"Pod",namespaced:!0},V1Node:{group:"",version:"v1",resource:"nodes",kind:"Node"},V1Namespace:{group:"",version:"v1",resource:"namespaces",kind:"Namespace"},V1SelfSubjectAccessReview:{group:"authorization.k8s.io",version:"v1",resource:"selfsubjectaccessreviews",kind:"SelfSubjectAccessReview"},V1ClusterRole:{group:"rbac.authorization.k8s.io",version:"v1",resource:"clusterroles",kind:"ClusterRole"},V1ClusterRoleBinding:{group:"rbac.authorization.k8s.io",version:"v1",resource:"clusterrolebindings",kind:"ClusterRoleBinding"},V1Role:{group:"rbac.authorization.k8s.io",version:"v1",resource:"roles",kind:"Role",namespaced:!0},V1RoleBinding:{group:"rbac.authorization.k8s.io",version:"v1",resource:"rolebindings",kind:"RoleBinding",namespaced:!0},V1Secret:{group:"",version:"v1",resource:"secrets",kind:"Secret",namespaced:!0},V1ConfigMap:{group:"",version:"v1",resource:"configmaps",kind:"ConfigMap",namespaced:!0},V1Service:{group:"",version:"v1",resource:"services",kind:"Service",namespaced:!0},V1User:{group:"",version:"v1",resource:"users",kind:"User",namespaced:!1},V1StorageClassList:{group:"storage.k8s.io",version:"v1",resource:"storageclasses",kind:"StorageClass",namespaced:!1},V1Beta1PodMetrics:{group:"metrics.k8s.io",version:"v1beta1",resource:"pods",kind:"PodMetrics",namespaced:!0}};function v(a,e,r){return{apiVersion:a.group?a.group+"/"+a.version:a.version,kind:a.kind,metadata:{name:e},...r}}var I=class{constructor(e,r=void 0){this.val=e;this.extra=r;this.ok=!1;this.err=!0}},A=class{constructor(e,r=void 0){this.val=e;this.extra=r;this.ok=!0;this.err=!1}};var U="",K="Network",le="Forbidden",pe="BadRequest",N="NotFound",q="Unauthorized",me="AlreadyExists",ge="InternalServerError",Ve="NotImplemented",de="BadGateway",G="ServiceUnavailable",fe="GatewayTimeout",y=a=>{switch(a){case 400:return pe;case 401:return q;case 403:return le;case 404:return N;case 409:return me;case 500:return ge;case 501:return Ve;case 502:return de;case 503:return G;case 504:return fe}return U},o=class{static Ok(){return new A(void 0)}static Value(e){return new A(e)}static Failed(e,r="",t=U,s=void 0){return new I(new L(e,t,r),s)}static Error(e){return new I(e)}static WithExtra(e,r=void 0){return e.extra=r,e}},L=class{constructor(e,r=U,t=""){this.message=e;this.type=r;this.reason=t}};function b(a){return a||[]}var re=_(require("json-merge-patch"));var x={loftAccessKeyIdentifier:"loft_access_key",loftImpersonateSubjectIdentifier:"loft_impersonate_subject",loftImpersonateJoinedGroupIdentifier:"loft_impersonate_joined_group"};var k={secure:!0,expires:365*10,sameSite:"strict"},d=x.loftAccessKeyIdentifier,M=x.loftImpersonateSubjectIdentifier,P=x.loftImpersonateJoinedGroupIdentifier,he=["v4.channel.k8s.io","v3.channel.k8s.io","v2.channel.k8s.io","channel.k8s.io"];function D(){return window.location.href.startsWith("http://localhost:3000")?"https://localhost:9898":""}function Re(){return window.location.host=="localhost:3000"?"wss://localhost:8080":`${window.location.protocol=="https:"?"wss":"ws"}://${window.location.host}`}function Z(a){return[a.virtualCluster?"loft:vcluster:main":`loft:space:${a.project}:${a.space}`]}var F="/kubernetes/management",T="/kubernetes/cluster/",H="/kubernetes/virtualcluster/",B="/kubernetes/project/";function ve(a){return"loft-p-"+a}var S=class{constructor(){this.apiHost="";this.wsHost="";this.accessKey="";this.apiHost=D(),this.wsHost=Re(),this.accessKey=S.getAccessKey()}static getAccessKey(){return localStorage.getItem(d)}static tryCastToStatus(e){if(e.kind){if(e.kind!=="Status"||e.apiVersion!=="v1")return o.Value(null)}else return o.Value(null);return o.Value(e)}async getUser(){let e=await u.management(l.ManagementV1Self).Create(v(l.ManagementV1Self));return e.err?e:e.val.status?.user?(window.loft||(window.loft={}),window.loft.instanceID=e.val.status.instanceID,window.loft.intercomHash=e.val.status.intercomHash,window.loft.user=e.val.status.user,o.Value(e.val.status.user.name)):o.Failed("no user found")}getAccessKey(){return this.accessKey}async loftVersion(e){try{let r=D()+"/version";e&&(r+="?refresh=true");let s=await(await fetch(r)).json();return o.Value(s)}catch(r){return console.error(r),o.Failed("error during version retrieval")}}impersonatedUser(){try{let e=localStorage.getItem(M);if(e)return JSON.parse(e)}catch(e){console.error(e)}}impersonate(e,r,t){r?(localStorage.setItem(M,JSON.stringify({name:e,subject:r,groups:t})),r&&m.default.set(M,r,k),t?.forEach(s=>{let n=m.default.get(P);n?(n+=", "+s,m.default.set(P,n,k)):m.default.set(P,s,k)})):(localStorage.removeItem(M),m.default.remove(M),m.default.remove(P))}async login(e,r){let t=await this.request("/auth/password/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:r})});if(t.err)return t;let s=t.val;return this.setAccessKey(s.accessKey),o.Ok()}async loginWithAccessKey(e){this.isLoggedIn()&&await this.logout(),this.accessKey=e;let r=await u.management(l.ManagementV1Self).Create(v(l.ManagementV1Self));return r.err?(this.clearStorage(),r):(this.setAccessKey(e),o.Ok())}isLoggedIn(){return!!this.accessKey}setAccessKey(e){this.accessKey=e,localStorage.setItem(d,e),m.default.set(d,e,k)}async stream(e,r){try{let t=await fetch(this.apiHost+e,r);return t.status>=400||!t.body?await this.parseResponse(e,t):o.Value(t.body.getReader())}catch(t){return o.Failed(t+"","NetworkError",K)}}async request(e,r){try{let t=await fetch(this.apiHost+e,{...r,credentials:"same-origin"});return await this.parseResponse(e,t)}catch(t){return o.Failed(t+"","NetworkError",K)}}async socket(e){return this.refreshCookie(),new Promise((r,t)=>{let s=new WebSocket(`${this.wsHost}${e}`,he),n=!1;s.onopen=()=>{n=!0,r(s)},s.onerror=c=>{if(!n){let i=m.default.get(d)!="";t(i?c:new Error("Web socket is not authenticated. Please log in again"))}}})}async parseResponse(e,r){let t=await r.text(),s;try{s=JSON.parse(t)}catch{if(r.status===404)return o.Failed("page not found","NotFound",N);if(r.status===503){if(e.includes("kiosk.sh")||e.includes("cluster.loft.sh")){let i=e.split("/");return i.length>=4&&i[0]===""&&i[1]==="kubernetes"&&i[2]==="cluster"?o.Failed("Loft-agent seems to be currently unavailable, it is maybe just starting up. Click <a href={`/spaces/${splitted[3]}/loft`}>here</a> for more information</span>","LoftAgentUnavailable",G):o.Failed("loft-agent seems to be currently unavailable, it is maybe just starting up","LoftAgentUnavailable",G)}}else if(r.status===200)return o.Value(t);return console.info("Unexpected Server Response",t),o.Failed("Unexpected server response",y(r.status),y(r.status))}let n=S.tryCastToStatus(s);return n.err?n:n.val!==null&&n.val.status==="Failure"?n.val.code===500&&(n.val.message?.indexOf("vcluster secret not found")!==-1||n.val.message.indexOf("no ready pod for virtual cluster")!==-1)?o.Failed("vcluster seems to be not ready. Please refresh in a second",n.val.reason,y(n.val.code)):o.Failed(n.val.message,n.val.reason,y(n.val.code)):r.status>=400?o.Failed("unknown error","Unknown",y(r.status)):o.Value(s)}management(e){return new p({basePath:F,groupVersionResource:e,headers:this.impersonationHeaders()})}managementNonResource(){return new p({basePath:F,headers:this.impersonationHeaders()})}cluster(e,r){return new p({basePath:T+e,groupVersionResource:r,headers:this.impersonationHeaders()})}clusterNonResource(e){return new p({basePath:T+e,headers:this.impersonationHeaders()})}project(e,r){return new p({basePath:B+e.project+"/"+(e.space?"space/"+e.space:"virtualcluster/"+e.virtualCluster),groupVersionResource:r,project:e,headers:this.impersonationHeaders(Z(e))})}projectNonResource(e){return new p({basePath:B+e.project+"/"+(e.space?"space/"+e.space:"virtualcluster/"+e.virtualCluster),project:e,headers:this.impersonationHeaders(Z(e))})}vCluster(e,r){return new p({basePath:H+e.cluster+"/"+e.namespace+"/"+e.name,groupVersionResource:r,vCluster:e,headers:this.impersonationHeaders()})}vClusterNonResource(e){return new p({basePath:H+e.cluster+"/"+e.namespace+"/"+e.name,vCluster:e,headers:this.impersonationHeaders()})}auto(e,r,t,s){return t?this.project(t,s):r?this.vCluster(r,s):e?this.cluster(e,s):this.management(s)}autoNonResource(e,r,t){return t?this.projectNonResource(t):r?this.vClusterNonResource(r):e?this.clusterNonResource(e):this.managementNonResource()}async doRawSocket(e){try{return o.Value(await this.socket(e))}catch(r){return console.error(r),o.Failed(r.message||JSON.stringify(r))}}async doRawStream(e,r,t){return this.doRawInternal(e,r,t,!0)}async doRaw(e,r,t){return this.doRawInternal(e,r,t)}async doRawInternal(e,r,t,s){let n=this.accessKey,c=n?new Headers({...t,Authorization:"bearer "+n,"X-Sleep-Mode-Ignore":"true"}):new Headers({...t,"X-Sleep-Mode-Ignore":"true"}),i=s?await this.stream(e,{...r,headers:c}):await this.request(e,{...r,headers:c});return i.err&&i.val.type===q&&(i.val.message==="loft access key not found. Please login again"||i.val.message==="invalid bearer token")&&(this.clearStorage(),window.location.href="/",await new Promise(()=>{})),i}impersonationHeaders(e){let r=this.impersonatedUser(),t={};return r&&(r.subject&&(t["Impersonate-User"]=r.subject),[...b(r.groups),...b(e)].forEach(s=>{t["Impersonate-Joined-Group"]?t["Impersonate-Joined-Group"]+=", "+s:t["Impersonate-Joined-Group"]=s})),t}clearStorage(){this.accessKey=null,localStorage.removeItem(d),localStorage.removeItem(M),m.default.remove(d,{secure:!0}),m.default.remove(M,{secure:!0}),m.default.remove(P,{secure:!0})}refreshCookie(){let e=this.accessKey||localStorage.getItem(d),r=m.default.get(d);e&&e!=r&&m.default.set(d,e,k)}async logout(){let e=await this.management(l.ManagementV1Self).Create(v(l.ManagementV1Self));if(e.err)return this.clearStorage(),e;if(!e.val.status?.accessKey)return this.clearStorage(),o.Ok();let r=await this.management(l.ManagementV1OwnedAccessKey).Delete(e.val.status.accessKey);return r.err?(this.clearStorage(),r):(this.clearStorage(),o.Ok())}},J=class{},p=class{constructor(e){this.options=e}Name(e){return new p({...this.options,name:e})}Namespace(e){return e?new p({...this.options,namespace:e}):new p({...this.options})}Resource(e){return new p({...this.options,groupVersionResource:e})}buildPath(e){if(this.options.groupVersionResource)if(this.options.basePath){if(!this.options.name&&this.options.groupVersionResource.subResource)return o.Failed("resource name required when subresource is used")}else return o.Failed("basePath is missing");else return o.Failed("groupVersionResource is missing");let r=[this.options.basePath];this.options.groupVersionResource.group?r.push("apis",this.options.groupVersionResource.group):r.push("api"),r.push(this.options.groupVersionResource.version),this.options.namespace&&r.push("namespaces",this.options.namespace),r.push(this.options.groupVersionResource.resource),this.options.name&&r.push(this.options.name),this.options.groupVersionResource.subResource&&r.push(this.options.groupVersionResource.subResource);let t="";if(e){let s=[];for(let n of Object.keys(e))e[n]&&(Array.isArray(e[n])?e[n].forEach(c=>{s.push(n+"="+encodeURIComponent(c))}):s.push(n+"="+encodeURIComponent(e[n])));s.length>0&&(t="?"+s.join("&"))}else t="?timeout=180s";return o.Value(r.join("/")+t)}parseResourceList(e,r,t,s,n,c){for(let i=0;i<b(t.resources).length;i++){let V=t.resources[i];if(V===void 0)continue;let g=V.name.split("/"),f=g[0]??"";!c&&g.length>1||n&&s.find(C=>C.group===e&&C.resource===f)||s.push({resource:f,subResource:g.length>1?g[1]:void 0,group:e,version:r,kind:V.kind,namespaced:V.namespaced,verbs:V.verbs})}}async ApiResources(e,r){let t=[],s=await u.doRaw([this.options.basePath,"api"].join("/"));if(s.err)return s;let n=[];for(let i=0;i<b(s.val.versions).length;i++)n.push((async V=>{let g=s.val.versions[V];if(g===void 0)return;let f=await u.doRaw([this.options.basePath,"api",g].join("/"));if(f.err){console.error(f.val.message);return}this.parseResourceList("",g,f.val,t,e,r)})(i)),n.length>20&&(await Promise.all(n),n=[]);n.length>0&&(await Promise.all(n),n=[]);let c=await u.doRaw([this.options.basePath,"apis"].join("/"));if(c.err)return c;for(let i=0;i<b(c.val.groups).length;i++){let V=c.val.groups[i];if(V!==void 0)for(let g=0;g<b(V.versions).length;g++)n.push((async(f,C)=>{let E=C.versions[f];if(E===void 0)return;let O=await u.doRaw([this.options.basePath,"apis",C.name,E.version].join("/"));if(O.err){console.error(O.val.message);return}this.parseResourceList(C.name,E.version,O.val,t,e,r)})(g,V)),n.length>20&&(await Promise.all(n),n=[])}return n.length>0&&await Promise.all(n),o.Value(t)}async Version(){let e=[this.options.basePath,"version"];return await u.doRaw(e.join("/"))}async VirtualClusterInstanceLogs(e,r,t){let s=[this.options.basePath,`apis/management.loft.sh/v1/namespaces/${e}/virtualclusterinstances/${r}/log`].join("/"),n=[];if(t)for(let c of Object.keys(t))n.push(`${c}=${encodeURIComponent(t[c])}`);return n.length>0&&(s+="?"+n.join("&")),await u.doRawStream(s,void 0,this.options.headers)}async TaskLogs(e,r){let t=[this.options.basePath,`apis/management.loft.sh/v1/tasks/${e}/log`].join("/"),s=[];if(r)for(let n of Object.keys(r))s.push(`${n}=${encodeURIComponent(r[n])}`);return s.length>0&&(t+="?"+s.join("&")),await u.doRawStream(t,void 0,this.options.headers)}async Logs(e,r,t){let s=[this.options.basePath,`api/v1/namespaces/${e}/pods/${r}/log`].join("/"),n=ee(t);return n.length>0&&(s+="?"+n),await u.doRawStream(s,void 0,this.options.headers)}async Exec(e,r,t){let s=[this.options.basePath,`api/v1/namespaces/${e}/pods/${r}/exec`].join("/"),n=ee(t);return n.length>0&&(s+="?"+n),await u.doRawSocket(s)}async Path(e,r,t){let s=[this.options.basePath,e];return await u.doRaw(s.join("/"),r,{...t,...this.options.headers})}async Get(e,r){this.options.name=e;let t=this.buildPath(r);return t.err?t:o.WithExtra(await u.doRaw(t.val,void 0,this.options.headers),this.options)}async List(e){if(this.options.name)return o.Failed("name is set on a list request");let r=this.buildPath(e);return r.err?r:o.WithExtra(await u.doRaw(r.val,void 0,this.options.headers),this.options)}async ListTable(e){if(this.options.name)return o.Failed("name is set on a list request");let r=this.buildPath(e);return r.err?r:o.WithExtra(await u.doRaw(r.val,void 0,{...this.options.headers,Accept:"application/json;as=Table;v=v1;g=meta.k8s.io,application/json;as=Table;v=v1beta1;g=meta.k8s.io,application/json"}),this.options)}async Create(e,r){let t=this.buildPath(r);return t.err?t:o.WithExtra(await u.doRaw(t.val,{method:"POST",body:JSON.stringify(e)},{...this.options.headers,"Content-Type":"application/json"}),this.options)}async PatchObject(e,r,t,s){let n=re.default.generate(e,r);return this.Patch(r.metadata?.name,n,t,s)}async Patch(e,r,t,s){this.options.name=e;let n=this.buildPath(s);return n.err?n:o.WithExtra(await u.doRaw(n.val,{method:"PATCH",body:JSON.stringify(r,function(c,i){return i===void 0?null:i})},{...this.options.headers,"Content-Type":t||"application/merge-patch+json"}),this.options)}async Update(e,r,t){this.options.name=e;let s=this.buildPath(t);return s.err?s:o.WithExtra(await u.doRaw(s.val,{method:"PUT",body:JSON.stringify(r)},{...this.options.headers,"Content-Type":"application/json"}),this.options)}async Delete(e,r){this.options.name=e;let t=this.buildPath(r);return t.err?t:o.WithExtra(await u.doRaw(t.val,{method:"DELETE"},this.options.headers),this.options)}async CanI(e){let r=this.options.groupVersionResource,t=this.options.basePath?.indexOf(T)===0?this.options.basePath.substring(T.length):void 0,s,n;this.options.project?(s=u.project(this.options.project,l.V1SelfSubjectAccessReview),n=v(l.V1SelfSubjectAccessReview)):this.options.vCluster?(s=u.vCluster(this.options.vCluster,l.V1SelfSubjectAccessReview),n=v(l.V1SelfSubjectAccessReview)):t?(s=u.cluster(t,l.V1SelfSubjectAccessReview),n=v(l.V1SelfSubjectAccessReview)):(s=u.management(l.ManagementV1SelfSubjectAccessReview),n=v(l.ManagementV1SelfSubjectAccessReview)),n.spec={resourceAttributes:{verb:e,name:this.options.name,namespace:this.options.namespace,group:r.group,version:r.version,resource:r.resource,subresource:r.subResource}};let c=await s.Create(n);return c.err?c:o.Value(!!(c.val.status?.allowed&&!c.val.status.denied))}};function ee(a){let e=new URLSearchParams;for(let[r,t]of Object.entries(a))Array.isArray(t)?t.forEach(s=>{e.append(r,s)}):e.append(r,t);return e.toString()}var u=new S,te=u;0&&(module.exports={ClusterBasePath,List,ManagementBasePath,ProjectBasePath,VClusterBasePath,client,getApiHost,getProjectNamespace});
