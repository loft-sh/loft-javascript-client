"use strict";var me=Object.create;var I=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var fe=(o,e)=>{for(var s in e)I(o,s,{get:e[s],enumerable:!0})},z=(o,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of ge(e))!de.call(o,t)&&t!==s&&I(o,t,{get:()=>e[t],enumerable:!(r=pe(e,t))||r.enumerable});return o};var X=(o,e,s)=>(s=o!=null?me(Ve(o)):{},z(e||!o||!o.__esModule?I(s,"default",{value:o,enumerable:!0}):s,o)),he=o=>z(I({},"__esModule",{value:!0}),o);var Ie={};fe(Ie,{APIExtensionsGroup:()=>B,APIExtensionsGroupVersion:()=>Se,APIExtensionsVersion:()=>H,Client:()=>le,ClusterBasePath:()=>j,DownloadMimeType:()=>Y,Err:()=>y,ErrorTypeAlreadyExists:()=>se,ErrorTypeBadGateway:()=>ne,ErrorTypeBadRequest:()=>ee,ErrorTypeForbidden:()=>Z,ErrorTypeGatewayTimeout:()=>oe,ErrorTypeInternalError:()=>re,ErrorTypeNetwork:()=>S,ErrorTypeNotFound:()=>x,ErrorTypeNotImplemented:()=>te,ErrorTypeServiceUnavailable:()=>P,ErrorTypeUnauthorized:()=>T,ErrorTypeUnknown:()=>G,Failed:()=>E,List:()=>K,LoftSchemeGroup:()=>be,LoftSchemeGroupCluster:()=>M,LoftSchemeGroupStorage:()=>Ce,LoftSchemeGroupVersion:()=>Me,LoftSchemeGroupVersionCluster:()=>ve,LoftSchemeGroupVersionStorage:()=>ke,LoftSchemeGroupVersionVirtualCluster:()=>Re,LoftSchemeGroupVirtualCluster:()=>D,LoftSchemeVersion:()=>F,LoftSchemeVersionCluster:()=>C,LoftSchemeVersionStorage:()=>ye,LoftSchemeVersionVirtualCluster:()=>q,ManagementBasePath:()=>$,MapErrorCode:()=>R,NewResource:()=>V,Ok:()=>k,ProjectBasePath:()=>_,Resources:()=>l,Return:()=>a,VClusterBasePath:()=>W,getApiHost:()=>ce,getProjectFromNamespace:()=>je,getProjectNamespace:()=>Ae,isResult:()=>Te});module.exports=he(Ie);var m=X(require("js-cookie")),ue=X(require("json-merge-patch"));var b={loftAccessKeyIdentifier:"loft_access_key",loftImpersonateSubjectIdentifier:"loft_impersonate_subject",loftImpersonateJoinedGroupIdentifier:"loft_impersonate_joined_group",platformAccessKeyNotFound:"platform access key not found. Please login again"};function h(o){return o||[]}function U(o,e,s,r,t,n){for(let i=0;i<h(s.resources).length;i++){let u=s.resources[i];if(u===void 0)continue;let c=u.name.split("/"),p=c[0]??"";!n&&c.length>1||t&&r.find(f=>f.group===o&&f.resource===p)||r.push({resource:p,subResource:c.length>1?c[1]:void 0,group:o,version:e,kind:u.kind,namespaced:u.namespaced,verbs:u.verbs})}}var Q={ManagementV1AgentAuditEvent:{group:"management.loft.sh",version:"v1",resource:"agentauditevents",subResource:"",namespaced:!1,kind:"AgentAuditEvent"},ManagementV1Announcement:{group:"management.loft.sh",version:"v1",resource:"announcements",subResource:"",namespaced:!1,kind:"Announcement"},ManagementV1App:{group:"management.loft.sh",version:"v1",resource:"apps",subResource:"",namespaced:!1,kind:"App"},ManagementV1AppCredentials:{group:"management.loft.sh",version:"v1",resource:"apps",subResource:"credentials",namespaced:!1,kind:"AppCredentials"},ManagementV1Backup:{group:"management.loft.sh",version:"v1",resource:"backups",subResource:"",namespaced:!1,kind:"Backup"},ManagementV1BackupApply:{group:"management.loft.sh",version:"v1",resource:"backups",subResource:"apply",namespaced:!1,kind:"BackupApply"},ManagementV1Cluster:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"",namespaced:!1,kind:"Cluster"},ManagementV1ClusterAccess:{group:"management.loft.sh",version:"v1",resource:"clusteraccesses",subResource:"",namespaced:!1,kind:"ClusterAccess"},ManagementV1ClusterAccessKey:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"accesskey",namespaced:!1,kind:"ClusterAccessKey"},ManagementV1ClusterAgentConfig:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"agentconfig",namespaced:!1,kind:"ClusterAgentConfig"},ManagementV1ClusterCharts:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"charts",namespaced:!1,kind:"ClusterCharts"},ManagementV1ClusterDomain:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"domain",namespaced:!1,kind:"ClusterDomain"},ManagementV1ClusterMemberAccess:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"memberaccess",namespaced:!1,kind:"ClusterMemberAccess"},ManagementV1ClusterMembers:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"members",namespaced:!1,kind:"ClusterMembers"},ManagementV1ClusterReset:{group:"management.loft.sh",version:"v1",resource:"clusters",subResource:"reset",namespaced:!1,kind:"ClusterReset"},ManagementV1ClusterRoleTemplate:{group:"management.loft.sh",version:"v1",resource:"clusterroletemplates",subResource:"",namespaced:!1,kind:"ClusterRoleTemplate"},ManagementV1Config:{group:"management.loft.sh",version:"v1",resource:"configs",subResource:"",namespaced:!1,kind:"Config"},ManagementV1ConvertVirtualClusterConfig:{group:"management.loft.sh",version:"v1",resource:"convertvirtualclusterconfig",subResource:"",namespaced:!1,kind:"ConvertVirtualClusterConfig"},ManagementV1DatabaseConnector:{group:"management.loft.sh",version:"v1",resource:"databaseconnectors",subResource:"",namespaced:!1,kind:"DatabaseConnector"},ManagementV1DirectClusterEndpointToken:{group:"management.loft.sh",version:"v1",resource:"directclusterendpointtokens",subResource:"",namespaced:!1,kind:"DirectClusterEndpointToken"},ManagementV1Event:{group:"management.loft.sh",version:"v1",resource:"events",subResource:"",namespaced:!1,kind:"Event"},ManagementV1Feature:{group:"management.loft.sh",version:"v1",resource:"features",subResource:"",namespaced:!1,kind:"Feature"},ManagementV1IngressAuthToken:{group:"management.loft.sh",version:"v1",resource:"ingressauthtokens",subResource:"",namespaced:!1,kind:"IngressAuthToken"},ManagementV1Kiosk:{group:"management.loft.sh",version:"v1",resource:"kiosk",subResource:"",namespaced:!1,kind:"Kiosk"},ManagementV1License:{group:"management.loft.sh",version:"v1",resource:"licenses",subResource:"",namespaced:!1,kind:"License"},ManagementV1LicenseRequest:{group:"management.loft.sh",version:"v1",resource:"licenses",subResource:"request",namespaced:!1,kind:"LicenseRequest"},ManagementV1LicenseToken:{group:"management.loft.sh",version:"v1",resource:"licensetokens",subResource:"",namespaced:!1,kind:"LicenseToken"},ManagementV1LoftUpgrade:{group:"management.loft.sh",version:"v1",resource:"loftupgrades",subResource:"",namespaced:!1,kind:"LoftUpgrade"},ManagementV1NodeClaim:{group:"management.loft.sh",version:"v1",resource:"nodeclaims",subResource:"",namespaced:!0,kind:"NodeClaim"},ManagementV1NodeEnvironment:{group:"management.loft.sh",version:"v1",resource:"nodeenvironments",subResource:"",namespaced:!0,kind:"NodeEnvironment"},ManagementV1NodeProvider:{group:"management.loft.sh",version:"v1",resource:"nodeproviders",subResource:"",namespaced:!1,kind:"NodeProvider"},ManagementV1NodeProviderExec:{group:"management.loft.sh",version:"v1",resource:"nodeproviders",subResource:"exec",namespaced:!1,kind:"NodeProviderExec"},ManagementV1NodeType:{group:"management.loft.sh",version:"v1",resource:"nodetypes",subResource:"",namespaced:!1,kind:"NodeType"},ManagementV1OIDCClient:{group:"management.loft.sh",version:"v1",resource:"oidcclients",subResource:"",namespaced:!1,kind:"OIDCClient"},ManagementV1OwnedAccessKey:{group:"management.loft.sh",version:"v1",resource:"ownedaccesskeys",subResource:"",namespaced:!1,kind:"OwnedAccessKey"},ManagementV1Project:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"",namespaced:!1,kind:"Project"},ManagementV1ProjectChartInfo:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"chartinfo",namespaced:!1,kind:"ProjectChartInfo"},ManagementV1ProjectCharts:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"charts",namespaced:!1,kind:"ProjectCharts"},ManagementV1ProjectClusters:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"clusters",namespaced:!1,kind:"ProjectClusters"},ManagementV1ProjectImportSpace:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"importspace",namespaced:!1,kind:"ProjectImportSpace"},ManagementV1ProjectMembers:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"members",namespaced:!1,kind:"ProjectMembers"},ManagementV1ProjectMigrateSpaceInstance:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"migratespaceinstance",namespaced:!1,kind:"ProjectMigrateSpaceInstance"},ManagementV1ProjectMigrateVirtualClusterInstance:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"migratevirtualclusterinstance",namespaced:!1,kind:"ProjectMigrateVirtualClusterInstance"},ManagementV1ProjectNodeTypes:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"nodetypes",namespaced:!1,kind:"ProjectNodeTypes"},ManagementV1ProjectSecret:{group:"management.loft.sh",version:"v1",resource:"projectsecrets",subResource:"",namespaced:!0,kind:"ProjectSecret"},ManagementV1ProjectTemplates:{group:"management.loft.sh",version:"v1",resource:"projects",subResource:"templates",namespaced:!1,kind:"ProjectTemplates"},ManagementV1RedirectToken:{group:"management.loft.sh",version:"v1",resource:"redirecttokens",subResource:"",namespaced:!1,kind:"RedirectToken"},ManagementV1RegisterVirtualCluster:{group:"management.loft.sh",version:"v1",resource:"registervirtualclusters",subResource:"",namespaced:!1,kind:"RegisterVirtualCluster"},ManagementV1ResetAccessKey:{group:"management.loft.sh",version:"v1",resource:"resetaccesskeys",subResource:"",namespaced:!1,kind:"ResetAccessKey"},ManagementV1Self:{group:"management.loft.sh",version:"v1",resource:"selves",subResource:"",namespaced:!1,kind:"Self"},ManagementV1SelfSubjectAccessReview:{group:"management.loft.sh",version:"v1",resource:"selfsubjectaccessreviews",subResource:"",namespaced:!1,kind:"SelfSubjectAccessReview"},ManagementV1SharedSecret:{group:"management.loft.sh",version:"v1",resource:"sharedsecrets",subResource:"",namespaced:!0,kind:"SharedSecret"},ManagementV1SpaceInstance:{group:"management.loft.sh",version:"v1",resource:"spaceinstances",subResource:"",namespaced:!0,kind:"SpaceInstance"},ManagementV1SpaceTemplate:{group:"management.loft.sh",version:"v1",resource:"spacetemplates",subResource:"",namespaced:!1,kind:"SpaceTemplate"},ManagementV1SubjectAccessReview:{group:"management.loft.sh",version:"v1",resource:"subjectaccessreviews",subResource:"",namespaced:!1,kind:"SubjectAccessReview"},ManagementV1Task:{group:"management.loft.sh",version:"v1",resource:"tasks",subResource:"",namespaced:!1,kind:"Task"},ManagementV1TaskLog:{group:"management.loft.sh",version:"v1",resource:"tasks",subResource:"log",namespaced:!1,kind:"TaskLog"},ManagementV1Team:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"",namespaced:!1,kind:"Team"},ManagementV1TeamAccessKeys:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"accesskeys",namespaced:!1,kind:"TeamAccessKeys"},ManagementV1TeamClusters:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"clusters",namespaced:!1,kind:"TeamClusters"},ManagementV1TeamObjectPermissions:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"object-permissions",namespaced:!1,kind:"TeamObjectPermissions"},ManagementV1TeamPermissions:{group:"management.loft.sh",version:"v1",resource:"teams",subResource:"permissions",namespaced:!1,kind:"TeamPermissions"},ManagementV1TranslateVClusterResourceName:{group:"management.loft.sh",version:"v1",resource:"translatevclusterresourcenames",subResource:"",namespaced:!1,kind:"TranslateVClusterResourceName"},ManagementV1UsageDownload:{group:"management.loft.sh",version:"v1",resource:"usagedownload",subResource:"",namespaced:!1,kind:"UsageDownload"},ManagementV1User:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"",namespaced:!1,kind:"User"},ManagementV1UserAccessKeys:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"accesskeys",namespaced:!1,kind:"UserAccessKeys"},ManagementV1UserClusters:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"clusters",namespaced:!1,kind:"UserClusters"},ManagementV1UserObjectPermissions:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"object-permissions",namespaced:!1,kind:"UserObjectPermissions"},ManagementV1UserPermissions:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"permissions",namespaced:!1,kind:"UserPermissions"},ManagementV1UserProfile:{group:"management.loft.sh",version:"v1",resource:"users",subResource:"profile",namespaced:!1,kind:"UserProfile"},ManagementV1VirtualClusterAccessKey:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"accesskey",namespaced:!0,kind:"VirtualClusterAccessKey"},ManagementV1VirtualClusterConnection:{group:"management.loft.sh",version:"v1",resource:"virtualclusterconnections",subResource:"",namespaced:!1,kind:"VirtualClusterConnection"},ManagementV1VirtualClusterExternalDatabase:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"externaldatabase",namespaced:!0,kind:"VirtualClusterExternalDatabase"},ManagementV1VirtualClusterInstance:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"",namespaced:!0,kind:"VirtualClusterInstance"},ManagementV1VirtualClusterInstanceKubeConfig:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"kubeconfig",namespaced:!0,kind:"VirtualClusterInstanceKubeConfig"},ManagementV1VirtualClusterInstanceLog:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"log",namespaced:!0,kind:"VirtualClusterInstanceLog"},ManagementV1VirtualClusterInstanceShell:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"shell",namespaced:!0,kind:"VirtualClusterInstanceShell"},ManagementV1VirtualClusterInstanceSnapshot:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"snapshot",namespaced:!0,kind:"VirtualClusterInstanceSnapshot"},ManagementV1VirtualClusterNodeAccessKey:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"nodeaccesskey",namespaced:!0,kind:"VirtualClusterNodeAccessKey"},ManagementV1VirtualClusterResourceUsage:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"resourceusage",namespaced:!0,kind:"VirtualClusterResourceUsage"},ManagementV1VirtualClusterSchema:{group:"management.loft.sh",version:"v1",resource:"virtualclusterschemas",subResource:"",namespaced:!1,kind:"VirtualClusterSchema"},ManagementV1VirtualClusterStandalone:{group:"management.loft.sh",version:"v1",resource:"virtualclusterinstances",subResource:"standalone",namespaced:!0,kind:"VirtualClusterStandalone"},ManagementV1VirtualClusterTemplate:{group:"management.loft.sh",version:"v1",resource:"virtualclustertemplates",subResource:"",namespaced:!1,kind:"VirtualClusterTemplate"}};var D="virtualcluster.loft.sh",q="v1",Re="virtualcluster.loft.sh/v1",M="cluster.loft.sh",C="v1",ve="cluster.loft.sh/v1",be="management.loft.sh",F="v1",Me="management.loft.sh/v1",Ce="storage.loft.sh",ye="v1",ke="storage.loft.sh/v1",B="apiextensions.k8s.io",H="v1",Se="apiextensions.k8s.io/v1",K=class{},Y=(n=>(n.TEXT_CSV="text/csv;charset=utf-8;",n.TEXT_YAML="text/yaml;charset=utf-8;",n.TEXT_JSON="text/json;charset=utf-8;",n.TEXT_PLAIN="text/plain;charset=utf-8;",n.ZIP="application/zip",n))(Y||{});var l={...Q,ClusterV1SleepModeConfig:{group:M,version:C,resource:"sleepmodeconfigs",kind:"SleepModeConfig",namespaced:!0},ClusterV1HelmRelease:{group:M,version:C,resource:"helmreleases",kind:"HelmRelease",namespaced:!0},ClusterV1ChartInfo:{group:M,version:C,resource:"chartinfos",kind:"ChartInfo"},VirtualclusterV1HelmRelease:{group:D,version:q,resource:"helmreleases",kind:"HelmRelease",namespaced:!0},CustomResourceDefinition:{group:B,version:H,resource:"customresourcedefinitions",kind:"CustomResourceDefinition"},StorageV1ClusterQuota:{group:"storage.loft.sh",version:F,resource:"clusterquotas",kind:"ClusterQuota"},NetworkingV1Ingress:{group:"networking.k8s.io",version:"v1",resource:"ingresses",kind:"Ingress",namespaced:!0},V1StatefulSet:{group:"apps",version:"v1",resource:"statefulsets",kind:"StatefulSet",namespaced:!0},V1Deployment:{group:"apps",version:"v1",resource:"deployments",kind:"Deployment",namespaced:!0},V1Event:{group:"",version:"v1",resource:"events",kind:"Event",namespaced:!0},V1Pod:{group:"",version:"v1",resource:"pods",kind:"Pod",namespaced:!0},V1Node:{group:"",version:"v1",resource:"nodes",kind:"Node"},V1Namespace:{group:"",version:"v1",resource:"namespaces",kind:"Namespace"},V1SelfSubjectAccessReview:{group:"authorization.k8s.io",version:"v1",resource:"selfsubjectaccessreviews",kind:"SelfSubjectAccessReview"},V1ClusterRole:{group:"rbac.authorization.k8s.io",version:"v1",resource:"clusterroles",kind:"ClusterRole"},V1ClusterRoleBinding:{group:"rbac.authorization.k8s.io",version:"v1",resource:"clusterrolebindings",kind:"ClusterRoleBinding"},V1Role:{group:"rbac.authorization.k8s.io",version:"v1",resource:"roles",kind:"Role",namespaced:!0},V1RoleBinding:{group:"rbac.authorization.k8s.io",version:"v1",resource:"rolebindings",kind:"RoleBinding",namespaced:!0},V1Secret:{group:"",version:"v1",resource:"secrets",kind:"Secret",namespaced:!0},V1ConfigMap:{group:"",version:"v1",resource:"configmaps",kind:"ConfigMap",namespaced:!0},V1Service:{group:"",version:"v1",resource:"services",kind:"Service",namespaced:!0},V1User:{group:"",version:"v1",resource:"users",kind:"User",namespaced:!1},V1StorageClassList:{group:"storage.k8s.io",version:"v1",resource:"storageclasses",kind:"StorageClass",namespaced:!1},V1Beta1PodMetrics:{group:"metrics.k8s.io",version:"v1beta1",resource:"pods",kind:"PodMetrics",namespaced:!0}};function V(o,e,s){return{apiVersion:o.group?o.group+"/"+o.version:o.version,kind:o.kind,metadata:{name:e},...s}}var y=class{constructor(e,s=void 0){this.val=e;this.extra=s;this.ok=!1;this.err=!0}},k=class{constructor(e,s=void 0){this.val=e;this.extra=s;this.ok=!0;this.err=!1}};function Te(o){return"ok"in o&&typeof o.ok=="boolean"&&"err"in o&&typeof o.err=="boolean"}var G="",S="Network",Z="Forbidden",ee="BadRequest",x="NotFound",T="Unauthorized",se="AlreadyExists",re="InternalServerError",te="NotImplemented",ne="BadGateway",P="ServiceUnavailable",oe="GatewayTimeout",R=o=>{switch(o){case 400:return ee;case 401:return T;case 403:return Z;case 404:return x;case 409:return se;case 500:return re;case 501:return te;case 502:return ne;case 503:return P;case 504:return oe}return G},a=class{static Ok(){return new k(void 0)}static Value(e){return new k(e)}static Failed(e,s="",r=G,t=void 0){return new y(new E(e,r,s),t)}static Error(e){return new y(e)}static WithExtra(e,s=void 0){return e.extra=s,e}},E=class{constructor(e,s=G,r=""){this.message=e;this.type=s;this.reason=r}};var w={secure:!0,expires:365*10,sameSite:"strict"},d=b.loftAccessKeyIdentifier,v=b.loftImpersonateSubjectIdentifier,A=b.loftImpersonateJoinedGroupIdentifier,Pe=["v4.channel.k8s.io","v3.channel.k8s.io","v2.channel.k8s.io","channel.k8s.io"];function ce(){return typeof window<"u"&&window.location.href.startsWith("http://localhost:3000")?"https://localhost:9898":""}function we(){return typeof window>"u"||window.location.host==="localhost:3000"?"wss://localhost:8080":`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}`}function ae(o){return[o.virtualCluster?"loft:vcluster:main":`loft:space:${o.project}:${o.space}`]}var $="/kubernetes/management",j="/kubernetes/cluster/",W="/kubernetes/virtualcluster/",_="/kubernetes/project/",Ae=(o,e)=>o?e?`${e}${o}`:`p-${o}`:"p-";function je(o,e){if(o)return e?e.endsWith("-")?o.replace(new RegExp(`^${e}`),""):o.replace(new RegExp(`^${e}-`),""):o.replace(/^p-/,"")}var J=class o{constructor(e,s,r){this.apiHost="";this.wsHost="";this.accessKey="";this.managementNonResource=()=>new g(this,{basePath:$,headers:this.impersonationHeaders()});this.cluster=(e,s,r={})=>new g(this,{basePath:j+e,groupVersionResource:s,headers:{...this.impersonationHeaders(),...r}});this.clusterNonResource=e=>new g(this,{basePath:j+e,headers:this.impersonationHeaders()});this.project=(e,s,r={})=>new g(this,{basePath:_+e.project+"/"+(e.space?"space/"+e.space:"virtualcluster/"+e.virtualCluster),groupVersionResource:s,project:e,headers:{...this.impersonationHeaders(ae(e)),...r}});this.projectNonResource=e=>new g(this,{basePath:_+e.project+"/"+(e.space?"space/"+e.space:"virtualcluster/"+e.virtualCluster),project:e,headers:this.impersonationHeaders(ae(e))});this.apiHost=s||ce(),this.wsHost=r||we(),this.accessKey=e||o.getAccessKey()}static getAccessKey(){return localStorage.getItem(d)}static tryCastToStatus(e){if(e.kind){if(e.kind!=="Status"||e.apiVersion!=="v1")return a.Value(null)}else return a.Value(null);return a.Value(e)}async getUser(){let e=await this.management(l.ManagementV1Self).Create(V(l.ManagementV1Self));return e.err?e:e.val.status?.user?(typeof window<"u"&&(window.loft||(window.loft={}),window.loft.instanceID=e.val.status.instanceID,window.loft.chatAuthToken=e.val.status.chatAuthToken,window.loft.user=e.val.status.user),a.Value(e.val.status.user.name)):a.Failed("no user found")}getAccessKey(){return this.accessKey}async loftVersion(e){try{let s=this.apiHost+"/version";e&&(s+="?refresh=true");let t=await(await fetch(s)).json();return a.Value(t)}catch(s){return console.error(s),a.Failed("error during version retrieval")}}impersonatedUser(){try{let e=localStorage.getItem(v);if(e)return JSON.parse(e)}catch(e){console.error(e)}}impersonate(e,s,r){s?(localStorage.setItem(v,JSON.stringify({name:e,subject:s,groups:r})),s&&m.default.set(v,s,w),r?.forEach(t=>{let n=m.default.get(A);n?(n+=", "+t,m.default.set(A,n,w)):m.default.set(A,t,w)})):(localStorage.removeItem(v),m.default.remove(v),m.default.remove(A))}async login(e,s){let r=await this.request("/auth/password/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:s})});if(r.err)return r;let t=r.val;return this.setAccessKey(t.accessKey),a.Ok()}async loginWithAccessKey(e){this.isLoggedIn()&&await this.logout(),this.accessKey=e;let s=await this.management(l.ManagementV1Self).Create(V(l.ManagementV1Self));return s.err?(this.clearStorage(),s):(this.setAccessKey(e),a.Ok())}isLoggedIn(){return!!this.accessKey}setAccessKey(e){this.accessKey=e,localStorage.setItem(d,e),m.default.set(d,e,w)}async stream(e,s){try{let r=await fetch(this.apiHost+e,s);return r.status>=400||!r.body?await this.parseResponse(e,r):a.Value(r.body.getReader())}catch(r){return a.Failed(r+"","NetworkError",S)}}async blob(e,s){try{let r=await fetch(this.apiHost+e,s);return r.status>=400||!r.body?await this.parseResponse(e,r):a.Value(await r.blob())}catch(r){return a.Failed(r+"","NetworkError",S)}}async request(e,s,r){try{let t=await fetch(this.apiHost+e,{...s,credentials:"same-origin"});if(!t.ok){let i=await t.clone().text();if(t.status===401)try{let u=JSON.parse(i);if(u?.message===b.platformAccessKeyNotFound)return a.Failed(u.message||"Unauthorized",u.reason,T)}catch{}}return await this.parseResponse(e,t,r)}catch(t){let n=t;return n.message===b.platformAccessKeyNotFound&&(window.location.href=`/login?error=${n.message}&errorType=${n.reason}`),a.Failed(t+"","NetworkError",S)}}async socket(e,s){return this.refreshCookie(),new Promise((r,t)=>{let n=new WebSocket(`${this.wsHost}${e}`,s),i=!1;n.onopen=()=>{i=!0,r(n)},n.onerror=u=>{if(!i){let c=m.default.get(d)!="";t(c?u:new Error("Web socket is not authenticated. Please log in again"))}}})}async parseResponse(e,s,r){let t=await s.text(),n;try{n=JSON.parse(t)}catch{if(s.status===404)return a.Failed("page not found","NotFound",x);if(s.status===503){if(e.includes("kiosk.sh")||e.includes("cluster.loft.sh")){let c=e.split("/");return c.length>=4&&c[0]===""&&c[1]==="kubernetes"&&c[2]==="cluster"?a.Failed(`Agent seems to be currently unavailable, it is maybe just starting up. Click <a href="/spaces/${c[3]}/loft">here</a> for more information</span>`,"LoftAgentUnavailable",P):a.Failed("Agent seems to be currently unavailable, it is maybe just starting up","LoftAgentUnavailable",P)}}else if(s.status===200)return a.Value(t);return console.info("Unexpected Server Response",t),a.Failed("Unexpected server response",R(s.status),R(s.status))}let i=o.tryCastToStatus(n);return i.err?i:i.val!==null&&i.val.status==="Failure"?i.val.code===500&&(i.val.message?.indexOf("vcluster secret not found")!==-1||i.val.message.indexOf("no ready pod for virtual cluster")!==-1)?a.Failed("vcluster seems to be not ready. Please refresh in a second",i.val.reason,R(i.val.code)):a.Failed(i.val.message,i.val.reason,R(i.val.code)):s.status>=400?r&&r.includes(s.status)?a.Value(n):a.Failed("unknown error","Unknown",R(s.status)):a.Value(n)}management(e){return new g(this,{basePath:$,groupVersionResource:e,headers:this.impersonationHeaders()})}vCluster(e,s){return new g(this,{basePath:W+e.cluster+"/"+e.namespace+"/"+e.name,groupVersionResource:s,vCluster:e,headers:this.impersonationHeaders()})}vClusterNonResource(e){return new g(this,{basePath:W+e.cluster+"/"+e.namespace+"/"+e.name,vCluster:e,headers:this.impersonationHeaders()})}auto(e,s,r,t){return r?this.project(r,t):s?this.vCluster(s,t):e?this.cluster(e,t):this.management(t)}autoNonResource(e,s,r){return r?this.projectNonResource(r):s?this.vClusterNonResource(s):e?this.clusterNonResource(e):this.managementNonResource()}async doRawSocket(e,s){try{return a.Value(await this.socket(e,s))}catch(r){return console.error(r),a.Failed(r.message||JSON.stringify(r))}}async doRawStream(e,s,r){return this.doRawInternal(e,s,r,"stream")}async doRawBlob(e,s,r){return this.doRawInternal(e,s,r,"blob")}async doRaw(e,s,r,t){return this.doRawInternal(e,s,r,void 0,t)}async doRawInternal(e,s,r,t,n){let i=this.accessKey,u=i?new Headers({...r,Authorization:"bearer "+i,"X-Sleep-Mode-Ignore":"true","X-Platform-Client":"true"}):new Headers({...r,"X-Sleep-Mode-Ignore":"true","X-Platform-Client":"true"}),c=t==="stream"?await this.stream(e,{...s,headers:u}):t==="blob"?await this.blob(e,{...s,headers:u}):await this.request(e,{...s,headers:u},n);return c.err&&c.val.type===T&&(c.val.message==="Access key not found. Please login again"||c.val.message==="invalid bearer token")&&(this.clearStorage(),typeof window<"u"&&(window.location.href="/"),await new Promise(()=>{})),c}impersonationHeaders(e){let s=this.impersonatedUser(),r={};return s&&(s.subject&&(r["Impersonate-User"]=s.subject),[...h(s.groups),...h(e)].forEach(t=>{r["Impersonate-Joined-Group"]?r["Impersonate-Joined-Group"]+=", "+t:r["Impersonate-Joined-Group"]=t})),r}clearStorage(){this.accessKey=null,localStorage.removeItem(d),localStorage.removeItem(v),m.default.remove(d,{secure:!0}),m.default.remove(v,{secure:!0}),m.default.remove(A,{secure:!0})}refreshCookie(){let e=this.accessKey||localStorage.getItem(d),s=m.default.get(d);e&&e!=s&&m.default.set(d,e,w)}async logout(){let e=await this.management(l.ManagementV1Self).Create(V(l.ManagementV1Self));if(e.err)return this.clearStorage(),e;if(!e.val.status?.accessKey)return this.clearStorage(),a.Ok();let s=await this.management(l.ManagementV1OwnedAccessKey).Delete(e.val.status.accessKey);return s.err?(this.clearStorage(),s):(this.clearStorage(),a.Ok())}},g=class o{constructor(e,s){this.client=e,this.options=s}Name(e){return new o(this.client,{...this.options,name:e})}Namespace(e){return e?new o(this.client,{...this.options,namespace:e}):new o(this.client,{...this.options})}Resource(e){return new o(this.client,{...this.options,groupVersionResource:e})}AllowSpecificErrors(e){return new o(this.client,{...this.options,allowSpecificErrors:e})}buildPath(e){if(this.options.groupVersionResource)if(this.options.basePath){if(!this.options.name&&this.options.groupVersionResource.subResource)return a.Failed("resource name required when subresource is used")}else return a.Failed("basePath is missing");else return a.Failed("groupVersionResource is missing");let s=[this.options.basePath];this.options.groupVersionResource.group?s.push("apis",this.options.groupVersionResource.group):s.push("api"),s.push(this.options.groupVersionResource.version),this.options.namespace&&s.push("namespaces",this.options.namespace),s.push(this.options.groupVersionResource.resource),this.options.name&&s.push(this.options.name),this.options.groupVersionResource.subResource&&s.push(this.options.groupVersionResource.subResource);let r="";if(e){let t=[];for(let n of Object.keys(e))e[n]&&(Array.isArray(e[n])?e[n].forEach(i=>{t.push(n+"="+encodeURIComponent(i))}):t.push(n+"="+encodeURIComponent(e[n])));t.length>0&&(r="?"+t.join("&"))}else r="?timeout=180s";return a.Value(s.join("/")+r)}async ApiResources(e,s){let r=[],t=await this.client.doRaw([this.options.basePath,"api"].join("/"));if(t.err)return t;let n=[];for(let u=0;u<h(t.val.versions).length;u++)n.push((async c=>{let p=t.val.versions[c];if(p===void 0)return;let f=await this.client.doRaw([this.options.basePath,"api",p].join("/"));if(f.err){console.error(f.val.message);return}U("",p,f.val,r,e,s)})(u)),n.length>20&&(await Promise.all(n),n=[]);n.length>0&&(await Promise.all(n),n=[]);let i=await this.client.doRaw([this.options.basePath,"apis"].join("/"));if(i.err)return i;for(let u=0;u<h(i.val.groups).length;u++){let c=i.val.groups[u];if(c!==void 0)for(let p=0;p<h(c.versions).length;p++)n.push((async(f,O)=>{let N=O.versions[f];if(N===void 0)return;let L=await this.client.doRaw([this.options.basePath,"apis",O.name,N.version].join("/"));if(L.err){console.error(L.val.message);return}U(O.name,N.version,L.val,r,e,s)})(p,c)),n.length>20&&(await Promise.all(n),n=[])}return n.length>0&&await Promise.all(n),a.Value(r)}async Version(){let e=[this.options.basePath,"version"];return await this.client.doRaw(e.join("/"))}async VirtualClusterInstanceLogs(e,s,r){let t=[this.options.basePath,`apis/management.loft.sh/v1/namespaces/${e}/virtualclusterinstances/${s}/log`].join("/"),n=[];if(r)for(let i of Object.keys(r))n.push(`${i}=${encodeURIComponent(r[i])}`);return n.length>0&&(t+="?"+n.join("&")),await this.client.doRawStream(t,void 0,this.options.headers)}async TaskLogs(e,s){let r=[this.options.basePath,`apis/management.loft.sh/v1/tasks/${e}/log`].join("/"),t=[];if(s)for(let n of Object.keys(s))t.push(`${n}=${encodeURIComponent(s[n])}`);return t.length>0&&(r+="?"+t.join("&")),await this.client.doRawStream(r,void 0,this.options.headers)}async Logs(e,s,r){let t=[this.options.basePath,`api/v1/namespaces/${e}/pods/${s}/log`].join("/"),n=ie(r);return n.length>0&&(t+="?"+n),await this.client.doRawStream(t,void 0,this.options.headers)}async Exec(e,s,r){let t=[this.options.basePath,`api/v1/namespaces/${e}/pods/${s}/exec`].join("/"),n=ie(r);return n.length>0&&(t+="?"+n),await this.client.doRawSocket(t,Pe)}async Path(e,s,r){let t=[this.options.basePath,e];return await this.client.doRaw(t.join("/"),s,{...r,...this.options.headers},this.options.allowSpecificErrors)}ResolvePath(e){return e&&(this.options.name=e),this.buildPath()}async Get(e,s){this.options.name=e;let r=this.buildPath(s);return r.err?r:a.WithExtra(await this.client.doRaw(r.val,void 0,this.options.headers,this.options.allowSpecificErrors),this.options)}async GetFile(e){let s=this.buildPath(e);return s.err?s:a.WithExtra(await this.client.doRawBlob(s.val,void 0,this.options.headers),this.options)}async List(e){if(this.options.name)return a.Failed("name is set on a list request");let s=this.buildPath(e);return s.err?s:a.WithExtra(await this.client.doRaw(s.val,void 0,this.options.headers,this.options.allowSpecificErrors),this.options)}async ListTable(e){if(this.options.name)return a.Failed("name is set on a list request");let s=this.buildPath(e);return s.err?s:a.WithExtra(await this.client.doRaw(s.val,void 0,{...this.options.headers,Accept:"application/json;as=Table;v=v1;g=meta.k8s.io,application/json;as=Table;v=v1beta1;g=meta.k8s.io,application/json"},this.options.allowSpecificErrors),this.options)}async Create(e,s,r){let t=this.buildPath(s);return t.err?t:a.WithExtra(await this.client.doRaw(t.val,{method:"POST",body:JSON.stringify(e),signal:r},{...this.options.headers,"Content-Type":"application/json"},this.options.allowSpecificErrors),this.options)}async PatchObject(e,s,r,t){let n=ue.default.generate(e,s);return this.Patch(s.metadata?.name,n,r,t)}async Patch(e,s,r,t){this.options.name=e;let n=this.buildPath(t);return n.err?n:a.WithExtra(await this.client.doRaw(n.val,{method:"PATCH",body:JSON.stringify(s,function(i,u){return u===void 0?null:u})},{...this.options.headers,"Content-Type":r||"application/merge-patch+json"},this.options.allowSpecificErrors),this.options)}async Update(e,s,r){this.options.name=e;let t=this.buildPath(r);return t.err?t:a.WithExtra(await this.client.doRaw(t.val,{method:"PUT",body:JSON.stringify(s)},{...this.options.headers,"Content-Type":"application/json"}),this.options)}async Delete(e,s){this.options.name=e;let r=this.buildPath(s);return r.err?r:a.WithExtra(await this.client.doRaw(r.val,{method:"DELETE"},this.options.headers),this.options)}async CanI(e){let s=this.options.groupVersionResource,r=this.options.basePath?.indexOf(j)===0?this.options.basePath.substring(j.length):void 0,t,n;this.options.project?(t=this.client.project(this.options.project,l.V1SelfSubjectAccessReview),n=V(l.V1SelfSubjectAccessReview)):this.options.vCluster?(t=this.client.vCluster(this.options.vCluster,l.V1SelfSubjectAccessReview),n=V(l.V1SelfSubjectAccessReview)):r?(t=this.client.cluster(r,l.V1SelfSubjectAccessReview),n=V(l.V1SelfSubjectAccessReview)):(t=this.client.management(l.ManagementV1SelfSubjectAccessReview),n=V(l.ManagementV1SelfSubjectAccessReview)),n.spec={resourceAttributes:{verb:e,name:this.options.name,namespace:this.options.namespace,group:s.group,version:s.version,resource:s.resource,subresource:s.subResource}};let i=await t.Create(n);return i.err?i:a.Value(!!(i.val.status?.allowed&&!i.val.status.denied))}};function ie(o){let e=new URLSearchParams;for(let[s,r]of Object.entries(o))Array.isArray(r)?r.forEach(t=>{e.append(s,t)}):e.append(s,r);return e.toString()}var le=J;0&&(module.exports={APIExtensionsGroup,APIExtensionsGroupVersion,APIExtensionsVersion,Client,ClusterBasePath,DownloadMimeType,Err,ErrorTypeAlreadyExists,ErrorTypeBadGateway,ErrorTypeBadRequest,ErrorTypeForbidden,ErrorTypeGatewayTimeout,ErrorTypeInternalError,ErrorTypeNetwork,ErrorTypeNotFound,ErrorTypeNotImplemented,ErrorTypeServiceUnavailable,ErrorTypeUnauthorized,ErrorTypeUnknown,Failed,List,LoftSchemeGroup,LoftSchemeGroupCluster,LoftSchemeGroupStorage,LoftSchemeGroupVersion,LoftSchemeGroupVersionCluster,LoftSchemeGroupVersionStorage,LoftSchemeGroupVersionVirtualCluster,LoftSchemeGroupVirtualCluster,LoftSchemeVersion,LoftSchemeVersionCluster,LoftSchemeVersionStorage,LoftSchemeVersionVirtualCluster,ManagementBasePath,MapErrorCode,NewResource,Ok,ProjectBasePath,Resources,Return,VClusterBasePath,getApiHost,getProjectFromNamespace,getProjectNamespace,isResult});
